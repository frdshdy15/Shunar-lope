/* script.js - handles message injection, typewriter, confetti, download, share, hearts */

/* ---------- === PASTE EXACT USER TEXT HERE (NO CHANGES) === ---------- */
const SOURCE_TEXT = `Selamat 18 Tahun, Shunnar.
Dari AninNovember 06, 2025
Serta mulia, Ncuun Scooooopy <3
Hari ini tepat 6,574 hari kamu berada di dunia ini, dan lembaran ke-18 dihidupmu di mulai. Orang-orang tersayangmu tersenyum merekah atas kelahiranmu. Kamu dinantikan oleh semua orang. Maka, sebelum membaca ucapanku lebih jauh lagi, berterima kasih lah terlebih dahulu untuk dirimu karena telah bertahan sejauh ini. Kamu keren, kamu hebat, terima kasih sudah hadir, terima kasih sudah bertahan, terima kasih sudah bekerja keras, mungkin tampak klise tapi itulah kebenarannya.
Tapi jangan merasa puas dahulu, ini semua baru permulaan, perjuangan akan dimulai setelah ini, perjalanan panjang menanti untuk dinikmati. Mungkin setelah ini sudah tak banyak lagi yang menganggap kamu sebagai anak kecil yang tak mengerti cara mengikat sepatu, atau sekadar merapikan tempat tidur. Kamu sudah beranjak, ya… sudah “dewasa” katanya. Aku tau, mungkin hal itu sedikit terdengar… menakutkan? Atau memang menakutkan. Tapi percayalah, aku yakin kamu bisa melewati segala masalah yang ada.
——————————————————————————————————
[ini aku kasih bates soalnya udah beda vibes wkwkwk]
Shun, aku bersyukur banget tau bisa kenal dan temenan sm kamu sampe skrg. Aku seneng banget kita masih bisa saling cerita, dan tuker kabar. Makasih ya atas suka, duka, dan segala hal selama kita berteman. Intinya aku bersyukur ada kamu di kehidupan aku yg singkat ini. Kamu selaaaalu mau dengerin tiap keluh kesah aku, walaupun hal ga penting dan sepele, kamu pasti selalu respon dengan sabaaarr, selalu nanggepin, selalu excited dengan apapun yg aku omongin [eum mff ya klw ak sk yapping, mff klw risih]
Kamu tau tentang aku, tentang segala baik bahkan buruknya aku. Even aku punya mental issues kamu tetep mau temenan sm aku.. kayak… terharu jujur [ups alay]. Aku tuh udah sepercaya itu sama kamu, menurutku kamu tuh bisa diandelin, dan bener bener tulus :( Selalu kayak gini ya, Shun. Tetap jadi Shunnar Mulvy yang aku kenal, si bocah behel yang udah ga pake behel, si nyengir, si sok sibuk, si atlet renang [besti asep], si model yang gamaw dibilang model wkwkwk pokoknya selalu jadi Shunnar yang baik bangeteett, yang selalu peduli sama orang sekitar, yang selalu nurut sama Bunda.
Duh, sebenarnya agak alay jg bikin kata-kata begini, tapi buat Shunnar apsh yg egx [jujur merinding]. Wish u all the best deh pokoknya hehehe. Yang paling penting tetap inget Allah kemanapun kamu melangkah, ngapain aja harus inget kalo ada Allah yg ngawasin kamu, terus nurut sama orang tua, itu 2 kunci kesuksesan hidup! Sehat-sehat, Shun. Jaga pola makan, kesehatan tuh penting, JANGAN KEBANYAKAN NGOPI ELAHHHHH ntar sakit lambung kak. Jaga pergaulan, walaupun ak percaya kamu gak bakalan aneh-aneh, awas klw tbtb keseret pergaulan bebas jatinewyork tak geprek sok. Tahun ke tahun udah di jalanin, pasti banyak pelajaran yang didapet. Ambil baiknya, buang jauh-jauh buruknya. Gapapa namanya juga hidup, kadang kidding, ambil aj hikmahny. Semangat terus menjalani kehidupan yang saat ini lagi dijalanin, tolong jangan nyerah ya seberat apapun itu, gaskan bg ingat kita anak pertama #BismillahAllahBersamaAnakPertama. Semoga kehidupan di tahun yang ke delapan belas ini, selalu ada hal baik yang kamu dapetin, selalu dikasih kebahagiaan.
Gak kerasa kita udah temenan selama 99 abad ups-! GA BOSENNN AK TUH BLG MAKASIHHHH. Makasih selalu dengerin keluh kesah ak, gonjang ganjing hidup ak, daaan makasih udahhh mauu temenan sm aku… eum… makasih juga udah bisa lewatin banyak hal jahat, aku tau kadang hidup gabisa kita kontrol, kadang ga sesuai ekspektasi, tapi yakin deh bakal selalu ada kebahagiaan yang dateng [walaupun kdg telat dikit lol]. Mungkin tahun ini salah satu tahun yg lumayan berat yh… buat kamu… buat agit tentunya… siap siap jg sama apapun yg bakal terjadi di tahun depan. Apapun nanti, tetep inget kalau kamu udah berusaha semaksimal mungkin, jadi plsss bangga ke diri kamu sendiri.
You’ve been dealing with family problems, fighting battles in your own mind, and carrying more than anyone could ever imagine. Yet you still give your best to everyone around you, even while hurting inside. What a kind and strong soul you are. I hope life gives back everything you've been giving away. You don't deserve pain, you deserve peace, love, and success. I’m proud of you for surviving every single day. God's plan is always the best. Sometimes the process is painful and hard, but don't forget that when God is silent, he’s doing something for you. After all the exhaustion you went through today, don't forget to appreciate yourself. find the little things that make you want to live and keep going one more day, then another, and another. And when no one is proud of you, i will!!! And u should proud of your self too.
Semoga di ulang tahun yang ke 18 ini, semua doa dan harapan baik kamu terkabul. Semoga kemanapun kamu melangkah selalu diiringi doa dan restu orang tua. Yang paling penting semoga selalu sehat, bahagia, sukses dalam segala hal, dan YG PENTING BGT dikelilingi orang-orang yang sayang sm kamu.
Aku pernah baca quotes gini… “Bermimpilah semustahil mungkin, Lalu berdoalah kepada-Nya, karena Allah akan mewujudkannya, bahkan dengan cara yang lebih mustahil.” Jadi, kalau Allah aja percaya bahwa hamba-Nya bisa, kenapa kamu ga percaya? Ayooo semangatt terusss, aku yakin kamu bisa.
Once again, Happy Birthday bff selamanya [pls jgn tinggalkan ak, nnti gkda yg bs mabar rosblok sm ak lgih]. Semoga tahun-tahun selanjutnya lebih bahagia lagi. Semoga kita selalu dipertemukan diseluruh kehidupan di alam semesta ini. Semoga kita dipertemukan lagi di surga-Nya Allah aamiin. U desereve all good things in this world, PLEASE JANGAN LUPAAA BAHAGIAA SELALUUU, JANGAN LUPA SENYUMMM YAAAH. Masih banyak banget yang maw ak sampein tp kykny udahan dl gksih? Panjang bener ni ucapan udh kyk nota tagihan utang ajh…
Sekali lagi, selamat menikmati delapan belas tahun.
Dariku, Anin!`;

/* ---------- DOM elements ---------- */
const messageEl = document.getElementById('message');
const revealBtn = document.getElementById('revealBtn');
const confettiBtn = document.getElementById('confettiBtn');
const downloadBtn = document.getElementById('downloadBtn');
const shareBtn = document.getElementById('shareBtn');
const floatContainer = document.getElementById('floatContainer');
const confettiCanvas = document.getElementById('confettiCanvas');

/* ---------- initial render (static) ---------- */
/* show a shortened preview immediate for fast load on mobile */
const PREVIEW = SOURCE_TEXT.split('\n').slice(0,6).join('\n') + '\n\n... (ketuk "Tampilkan Efek Ketik" untuk seluruh pesan)';
messageEl.textContent = PREVIEW;

/* ---------- typewriter reveal ---------- */
revealBtn.addEventListener('click', () => {
  revealBtn.disabled = true;
  messageEl.textContent = '';
  // mobile-friendly speed
  let i = 0;
  const text = SOURCE_TEXT;
  const baseDelay = 14; // ms per char (adjust for speed)
  function step() {
    if (i < text.length) {
      // show chunk for performance
      const nextChunk = text.slice(i, i + 6);
      messageEl.textContent += nextChunk;
      i += nextChunk.length;
      // scroll into view on mobile
      messageEl.scrollIntoView({behavior:'smooth',block:'center'});
      setTimeout(step, baseDelay + Math.random()*18);
    } else {
      revealBtn.disabled = false;
    }
  }
  step();
});

/* ---------- download as .txt ---------- */
downloadBtn.addEventListener('click', () => {
  const blob = new Blob([SOURCE_TEXT], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'ucapan-shunnar.txt';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

/* ---------- share (navigator share if available) ---------- */
shareBtn.addEventListener('click', async () => {
  const pageUrl = location.href;
  if (navigator.share) {
    try {
      await navigator.share({
        title: 'Selamat 18 Tahun, Shunnar',
        text: SOURCE_TEXT.slice(0,200) + (SOURCE_TEXT.length>200 ? '...' : ''),
        url: pageUrl
      });
    } catch (err) {
      alert('Gagal share: ' + err);
    }
  } else {
    // fallback: copy url
    try {
      await navigator.clipboard.writeText(pageUrl);
      alert('Link disalin ke clipboard: ' + pageUrl);
    } catch {
      prompt('Salin link ini manual:', pageUrl);
    }
  }
});

/* ---------- floating decorative hearts (DOM) ---------- */
function spawnFloatingHearts(count = 8) {
  for (let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'f-heart';
    el.style.position = 'absolute';
    el.style.left = (10 + Math.random()*80) + '%';
    el.style.bottom = (-10 - Math.random()*10) + 'px';
    el.style.opacity = 0.95;
    el.style.transform = `translateY(0) scale(${0.7 + Math.random()*0.8}) rotate(${Math.random()*30-15}deg)`;
    el.innerHTML = '<svg viewBox="0 0 24 24" width="36" height="36" style="display:block;fill:rgba(255,80,140,0.95)"><path d="M12 21s-7.5-4.6-10.2-8.2C-0.8 8.6 3.8 4 7.6 6.2 9.1 7.1 10 8.6 12 10c2-1.4 2.9-2.9 4.4-3.8 3.8-2.2 8.4 2.4 5.8 6.8C19.5 16.4 12 21 12 21z"/></svg>';
    floatContainer.appendChild(el);

    // animate
    const duration = 6000 + Math.random()*6000;
    el.animate([
      { transform: el.style.transform, opacity: 0, offset: 0 },
      { transform: `translateY(-140vh) scale(${1 + Math.random()*0.4}) rotate(${Math.random()*40-20}deg)`, opacity: 1, offset: 0.2 },
      { transform: `translateY(-220vh) scale(${0.9}) rotate(${Math.random()*60-30}deg)`, opacity: 0, offset: 1 }
    ], { duration, iterations: 1, easing: 'cubic-bezier(.2,.8,.2,1)' });

    // cleanup
    setTimeout(()=> el.remove(), duration + 200);
  }
}
// spawn some on load
spawnFloatingHearts(6);
// spawn periodically
setInterval(()=> spawnFloatingHearts(2 + Math.floor(Math.random()*3)), 4000);

/* ---------- confetti hearts on canvas (lightweight) ---------- */
(function initConfetti(){
  const canvas = confettiCanvas;
  const ctx = canvas.getContext('2d');
  let W = canvas.width = canvas.offsetWidth;
  let H = canvas.height = canvas.offsetHeight;
  window.addEventListener('resize', ()=> { W = canvas.width = canvas.offsetWidth; H = canvas.height = canvas.offsetHeight; });

  const particles = [];

  function spawnParticle() {
    const size = 8 + Math.random()*18;
    particles.push({
      x: Math.random()*W,
      y: H + 20,
      vx: (Math.random()-0.5)*2,
      vy: -(2 + Math.random()*5),
      size,
      life: 120 + Math.random()*80,
      age:0,
      hue: 320 + Math.random()*30,
      spin: (Math.random()-0.5)*0.02
    });
  }

  function drawHeart(x,y,s,h){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(Math.PI*s*0.01);
    ctx.fillStyle = `hsl(${h} 80% 65%)`;
    ctx.beginPath();
    ctx.moveTo(0, -s/4);
    ctx.bezierCurveTo(s/2, -s*0.9, s*1.2, -s*0.1, 0, s*1.2);
    ctx.bezierCurveTo(-s*1.2, -s*0.1, -s/2, -s*0.9, 0, -s/4);
    ctx.fill();
    ctx.restore();
  }

  let raf = null;
  function loop(){
    ctx.clearRect(0,0,W,H);
    for (let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.04; // gravity
      p.age++;
      p.size *= 0.999;
      const alpha = Math.max(0, 1 - p.age/p.life);
      ctx.globalAlpha = alpha;
      drawHeart(p.x, p.y, p.size, p.hue);
      if (p.age > p.life || p.y < -50) particles.splice(i,1);
    }
    ctx.globalAlpha = 1;
    raf = requestAnimationFrame(loop);
  }

  confettiBtn.addEventListener('click', ()=>{
    // spawn many
    for (let i=0;i<100;i++) spawnParticle();
    // start loop
    if (!raf) loop();
    // stop after 7s
    setTimeout(()=> {
      if (raf){ cancelAnimationFrame(raf); raf = null; ctx.clearRect(0,0,W,H); particles.length=0; }
    }, 7000);
  });
})();

/* ---------- small UX: tap card for sparkle (mobile) ---------- */
const card = document.getElementById('card');
card.addEventListener('click', ()=> {
  card.animate([
    { boxShadow: '0 12px 40px rgba(18,8,14,0.06)' },
    { boxShadow: '0 24px 80px rgba(255,110,170,0.18)' },
    { boxShadow: '0 12px 40px rgba(18,8,14,0.06)' }
  ], { duration: 650, easing: 'ease-out' });

  // mini hearts burst
  spawnFloatingHearts(5);
});

/* ---------- enable quick keyboard shortcut (k) for confetti on devices with keyboard ---------- */
document.addEventListener('keydown', (e)=>{
  if (e.key.toLowerCase()==='k') confettiBtn.click();
});

/* ---------- accessibility: focus message on load for screen readers ---------- */
window.addEventListener('load', ()=> {
  messageEl.setAttribute('aria-label', 'Ucapan ulang tahun dari Anin untuk Shunnar');
  // small delay then focus
  setTimeout(()=> messageEl.focus(), 300);
});
